---
title: "구 자작 NAS"
date: 2018-12-03 03:25:00 +0900
categories: NAS
---

그동안 우분투 시스템으로 자작한 NAS를 사용중이었는데, 무슨 바람이 들어 새 NAS를 만들겠다고 부품을 모으고 있다.
드래곤볼이 아직 다 모이지 않은 관계로, 기다리면서 그간 사용하던 자작 NAS에 대해서 끄적거려본다.

보통 상용 NAS를 많이 쓰고, 자작하는 경우 XPEnology 같은 NAS 운영체제를 사용하는 것이 일반적인데, 나는 내 구미대로 만들어 쓰겠노라 일을 키웠다.
호기롭게 필요한 것들을 설치해서 취향껏 쓰겠노라 일을 벌였는데, 쬐끔 세팅해서 SMB가 작동하니 지쳐서는... 그냥 그렇게 별 기능 없는 파일서버로 몇년을 썼다.

U-NAS에서 출시된 핫스왑 베이 4개를 갖춘 작고 예쁜 케이스, 비운의 AMD 재규어 쿼드코어 APU, 넉넉한 DDR3 16GB 램, 4TB+4TB 하드디스크, 운영체제는 128GB SSD

AMD A1 플랫폼은 SATA 포트를 2개만 지원했고, 메인보드에 추가 칩셋으로 2포트가 더 지원되어 SATA 포트가 총 4개뿐이었는데, 이를 모두 하드디스크 핫스왑 베이에 할당하겠다고 참 애썼다.
노트북에서 추출한 128GB mSATA SSD를 운영체제용으로 쓰려고 했는데, 메인보드가 mSATA도 지원하지 않고 SATA 포트도 아끼려니... 참 복잡하게 연결했던 기억이 난다.
mSATA를 SATA로 바꿔주는 PCB를 사서 SSD를 장착하고, 그걸 다시 SATA를 USB 3.0으로 변환하는 어댑터를 장착하고, 메인보드 USB 헤더에 변환 케이블을 연결해 장착하고...
여기서 이 SATA USB 어댑터 때문에 좀 골머리를 썪였는데, 당시에 멋모르고 UASP 기능을 지원하는 어댑터가 좋겠거니 샀다가 그걸 OS 용도로 사용하는데 삽질을 많이 했다.
일단 SATA에 연결해서 우분투 서버를 설치하고, 뭔가 부트로더를 잘 수정해서 UASP 어댑터에서 부팅가능하게 만들었던것 같은데... 한번 하고 나니 다시 건드리기 싫어져서 별 기능 없는 서버로 만드는 데 일조했던 것 같다.

16GB나 되는 램은 꽤나 오버 스펙이라, 나중에 굴러다니던 램으로 교체헤서 8GB로 다운그레이드 했다.
이것도 오버스펙이지만... 구형 램이라 속도가 667MHz로 허접했고, 4GB를 두개 장착했지만 A1 플랫폼은 싱글채널밖에 지원하지 않았다.
그렇게 속도가 느려졌다고 생각하니 참을 수 없어서, APU가 지원하는 최대 속도인 800MHz로 오버클럭 해버렸지.
뭐 자작 NAS라고 만들어서 업/다운로드밖에 안하는데 이게 다 뭔 소용이었나 싶다.

나중에 뭔가 활용도를 높혀보려고 X윈도 환경을 추가 설치했는데, 이것도 삽질이 많았다.
태블릿이나 노트북으로 VNC 접속해서 이렇게 저렇게 써볼까 했던건데... 뭐 결과적으로 설치는 다 했으나, 유튜브 영상 재생도 수월하지 않은 꼴을 보고 더이상 만지기 귀찮아졌던 것 같다.
제원상 성능을 생각하면 유튜브 정도는 잘 돌아가야 할텐데, 서버 구성에 X 환경만 최소 설치한거라 HW 가속과 관련된 뭔가가 누락된 것이지 싶었으나, 뭐 그냥 다 귀찮아졌다.

꼴에 서버라고 죽지 말라고 UPS도 달아줬다.
꽤나 본격적이다 하하
요게 뭐 서버 등급의 멋드러진 제품은 아니고, 가정용 멀티탭 형태로 만들어진 UPS다.
멀티탭 치고 꽤나 거대하고 묵직하다.
8구 멀티탭인데, 8구 모두 서지 프로텍션이 지원되고, 4구는 배터리 백업이 지원된다.
배터리 백업 4구에 모뎀, 공유기, 서버를 연결해뒀는데, 정말 몇년동안 쓰면서 서버가 꺼진 적이 없다.
이 UPS는 전용 USB 케이블로 PC에 연결할 수 있는데, 이를 통해서 서버가 UPS 상태를 파악할 수 있게 해준다.
관련 패키지를 설치하고 전원 공급이 차단되어 배터리가 일정 수준 이하가 되면 서버를 안전하게 종료하도록 설정해뒀는데, 그렇게 장시간동안 정전이 발생한 적은 없어서 아직 이 기능이 작동하는 걸 보진 못했다.

이 UPS를 구매한 건 사실 다른 이유에서 기획된 건데, 오랫동안 사용해온 스피커가 자꾸 부팅/종료할 때 펑 소리가 났었다.
인터넷에 자문을 구해보니 서지 프로텍션을 해보라는 권유를 받았고, 서지 프로텍션을 지원하는 멀티탭을 찾아보다가 이걸 보고는 계획이 이렇게 저렇게 바뀌어 결국 서버가 튼튼해졌다.
스피커 펑 소리는 해결이 되지 않았고 하하

하드디스크는 처음에 HGST 4TB 제품을 구매했다.
서버 시장에서 HGST가 고장률이 적다는 걸 주워듣고는 구매한거라 처음 써봤다.
이 때는 서버를 방에 두고 쓸 때였는데, 대체로 만족스러웠으나 헤드 파킹 후 다시 구동될 때 소음이 거슬리고 시간도 걸려 아쉬운 점이 있었다.
나중에 WD Green 4TB 제품을 추가했다.
이 제품은 헤드 파킹이 너무 빈번하다는 이슈가 있었고, 이에 WD가 헤드 파킹 설정을 변경하는 방법을 공개했다.
구매하자마자 헤드 파킹 설정을 변경했고, HGST처럼 재구동시 거슬리는 문제가 없었다.
그래서 앞으로 하드 추가는 Green으로 해야지 생각했었는데, Green 제품 라인이 사라져버렸지.
무엇보다 4베이를 하드로 꽉 채우자 원대한 꿈을 꾸며 삽질을 해놨는데... 2개로 몇년을 쓴지라 뭔 헛고생을 했던건가 싶네

내 자작 NAS에 우분투 서버 OS를 선택했던 주요 요인은, 기성 NAS OS를 설치해서 쓰면 남아돌 성능이 아깝다는 생각에서였다.
하지만 결과적으로 내 자작 NAS의 성능은 어지간히 남아돌았고, 요즘 NAS 전용 OS들을 알아보니 대부분 VM HOST 기능을 지원하며, 남는 CPU 자원을 활용할만한 여러 기능들도 고려해봄직 하였다.
그래서 새 NAS를 만들면 NAS OS를 사용해보려고 한다.
현재 생각중인 것은 FreeNAS인데, ZFS가 어떤 파일시스템인지 경험해보고 싶어서다.
XigmaNAS(구 Nas4Free)도 ZFS를 사용하는데, 커뮤니티의 규모나 상용 제품화 수준을 보니 FreeNAS 쪽이 좀 더 본격적이란 느낌을 받았다.
이에 대해서는 새 NAS를 만들 때 이야기해보겠다.
